"use strict";var _=require("lodash");!function(e){var t=function(){return{restrict:"AE",scope:{ngModel:"=?",highlightDays:"=?",dayClick:"=?",dayHover:"=?",month:"=?",monthChanged:"=?",weekDaysOff:"=?",allDaysOff:"=?",daysAllowed:"=?",sundayFirstDay:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",utcOffset:"=?"},template:'\n<div class="multiple-date-picker">\n    <div class="picker-top-row">\n        <div class="text-center picker-navigate picker-navigate-left-arrow"\n             ng-class="{\'disabled\':disableBackButton}" ng-click="previousMonth()">&lt;</div\n             ><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div\n             ><div class="text-center picker-navigate picker-navigate-right-arrow"\n             ng-class="{\'disabled\':disableNextButton}" ng-click="nextMonth()">&gt;</div>\n    </div>\n  <div class="picker-days-week-row">\n    <div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div>\n  </div>\n  <div class="picker-days-row">\n    <div class="text-center\n                picker-day\n                {{!day.mdp.otherMonth || showDaysOfSurroundingMonths ? day.css : \'\'}}\n                {{ day.mdp.otherMonth ? cssDaysOfSurroundingMonths : \'\'}}"\n         title="{{day.title}}"\n         ng-repeat="day in days track by $index"\n         ng-click="toggleDay($event, day)"\n         ng-mouseover="hoverDay($event, day)"\n         ng-mouseleave="dayHover($event, day)"\n         ng-class="{\n            \'picker-selected\':    is.selected(day.date),\n            \'picker-off\':         !day.selectable,\n            \'today\':              day.mdp.today,\n            \'past\':               day.mdp.past,\n            \'future\':             day.mdp.future,\n            \'picker-other-month\': day.mdp.otherMonth\n          }">\n          {{day ? day.mdp.otherMonth && !showDaysOfSurroundingMonths ? \'&nbsp;\' : day.date.format(\'D\') : \'\'}}\n\n          <div ng-if="day.annotation !== null && day.annotation !== undefined && day.annotation !== false" class="annotation">\n            {{day.annotation}}\n          </div>\n    </div>\n  </div>\n</div>',link:function(t){t.ngModel=t.ngModel||[],t.cache={selectedDates:{},highlightDays:{},daysAllowed:{},today:moment()},t.is={selected:function(e){return e.valueOf()in t.cache.selectedDates}};var a=function(){var e=moment(),a=moment(t.month).subtract(1,"month"),n=moment(t.month).add(1,"month");t.disableBackButton=t.disallowBackPastMonths&&e.isAfter(a,"month"),t.disableNextButton=t.disallowGoFuturMonths&&e.isBefore(n,"month")},n=function(){for(var e=moment().localeData()._weekdaysMin,a=[],n=1;7>n;n++)a.push(e[n]);return t.sundayFirstDay?a.splice(0,0,e[0]):a.push(e[0]),a};t.$watch(function(){return t.ngModel.map(function(e){return e.valueOf()})},function(e){t.cache.selectedDates=e?_.keyBy(e,function(e){return e.valueOf()}):{}},!0),t.$watch("highlightDays",function(a){e.isArray(a)?t.cache.highlightDays=_.keyBy(a,function(e){var t=moment(e.date);return Date.UTC(t.year(),t.month(),t.date())}):t.cache.highlightDays={}},!0),t.$watch(function(){return t.daysAllowed.map(function(e){return e.valueOf()})},function(){e.isArray(t.daysAllowed)?t.cache.daysAllowed=_.keyBy(t.daysAllowed,function(e){var t=moment(e);return Date.UTC(t.year(),t.month(),t.date())}):t.cache.daysAllowed={}},!0),t.$watchGroup(["cache.highlightDays","cache.daysAllowed","weekDaysOff","allDaysOff"],function(){t.generate()}),t.month=t.month||moment().startOf("day"),t.days=[],t.weekDaysOff=t.weekDaysOff||[],t.daysOff=t.daysOff||[],t.disableBackButton=!1,t.disableNextButton=!1,t.daysOfWeek=n(),t.cssDaysOfSurroundingMonths=t.cssDaysOfSurroundingMonths||"picker-empty",t.toggleDay=function(e,a){if(e.preventDefault(),!a.mdp.otherMonth||t.fireEventsForDaysOfSurroundingMonths){var n=!1;e.preventDefault=function(){n=!0},"function"==typeof t.dayClick&&t.dayClick(e,a),a.selectable&&!n&&(_.some(t.ngModel,function(e){return e.isSame(a.date,"day")})?t.ngModel=_.filter(t.ngModel,function(e){return!e.isSame(a.date,"day")}):t.ngModel.push(a.date))}},t.hoverDay=function(e,a){e.preventDefault();var n=!1;e.preventDefault=function(){n=!0},"function"==typeof t.dayHover&&t.dayHover(e,a)},t.previousMonth=function(){if(!t.disableBackButton){var e=moment(t.month);t.month=t.month.subtract(1,"month"),"function"==typeof t.monthChanged&&t.monthChanged(t.month,e),t.generate()}},t.nextMonth=function(){if(!t.disableNextButton){var e=moment(t.month);t.month=t.month.add(1,"month"),"function"==typeof t.monthChanged&&t.monthChanged(t.month,e),t.generate()}},t.isDayOff=function(a){var n=Date.UTC(a.date.year(),a.date.month(),a.date.date());return t.allDaysOff||!!t.disableDaysBefore&&moment(a.date).isBefore(t.disableDaysBefore,"day")||!!t.disableDaysAfter&&moment(a.date).isAfter(t.disableDaysAfter,"day")||e.isArray(t.weekDaysOff)&&t.weekDaysOff.some(function(e){return a.date.day()===e})||e.isArray(t.daysOff)&&t.daysOff.some(function(e){return a.date.isSame(e,"day")})||!t.cache.daysAllowed||!t.cache.daysAllowed[n]||n in t.cache.highlightDays&&!t.cache.highlightDays[n].selectable},t.isSelected=function(e){return t.ngModel.some(function(t){return e.date.isSame(t,"day")})},t.generate=function(){console.log("Generating...");var n=moment(t.month).date(0).day(t.sundayFirstDay?0:1).subtract(1,"day");moment(t.month).date(0).diff(n,"day")>6&&(n=n.add(1,"week"));var o=moment(t.month).date(1),d=[],s=moment(),i=moment(o).endOf("month"),r=function(){var a={date:moment(n.add(1,"day")),dateValue:0,annotation:null,mdp:{}};a.dateValue=a.date.valueOf();var o=Date.UTC(a.date.year(),a.date.month(),a.date.date());if(e.isArray(t.highlightDays)){var d=t.cache.highlightDays[o];d?(a.css=d.css,a.title=d.title,a.annotation=d.annotation):(a.css="",a.title="",a.annotation=null)}return a.selectable=!t.isDayOff(a),a.mdp.today=a.date.isSame(s,"day"),a.mdp.past=a.date.isBefore(s,"day"),a.mdp.future=a.date.isAfter(s,"day"),a.date.isSame(t.month,"month")||(a.mdp.otherMonth=!0),a},c=i.diff(n,"days"),l=t.sundayFirstDay?6:0;i.day()!==l&&(c+=(t.sundayFirstDay?6:7)-i.day());for(var y=0;c>y;y++)d.push(r());t.days=d,a()}}}};e.module("multipleDatePicker",[]).directive("multipleDatePicker",t)}(window.angular);