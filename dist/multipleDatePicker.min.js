"use strict";var _=require("lodash")(function(t){function e(t){return function(){return{link:function(e,n,a){console.log("Linking!"),n.on(t,function(n){e.$event=n,e.$apply(function(){var n="my"+t[0].toUpperCase()+t.substr(1);e.$eval(a[n])}),e.$event=null})}}}}var n=function(){return{restrict:"AE",scope:{ngModel:"=?",highlightDays:"=?",dayClick:"=?",dayHover:"=?",month:"=?",monthChanged:"=?",weekDaysOff:"=?",allDaysOff:"=?",daysAllowed:"=?",sundayFirstDay:"=?",disallowBackPastMonths:"=?",disallowGoFuturMonths:"=?",showDaysOfSurroundingMonths:"=?",cssDaysOfSurroundingMonths:"=?",fireEventsForDaysOfSurroundingMonths:"=?",disableDaysBefore:"=?",disableDaysAfter:"=?",utcOffset:"=?"},template:'\n<div class="multiple-date-picker">\n    <div class="picker-top-row">\n        <div class="text-center picker-navigate picker-navigate-left-arrow"\n             ng-class="{\'disabled\':disableBackButton}" ng-click="previousMonth()">&lt;</div\n             ><div class="text-center picker-month">{{month.format(\'MMMM YYYY\')}}</div\n             ><div class="text-center picker-navigate picker-navigate-right-arrow"\n             ng-class="{\'disabled\':disableNextButton}" ng-click="nextMonth()">&gt;</div>\n    </div>\n  <div class="picker-days-week-row">\n    <div class="text-center" ng-repeat="day in daysOfWeek">{{day}}</div>\n  </div>\n  <div class="picker-days-row">\n    <div class="text-center\n                picker-day\n                {{!is.otherMonth(day.date) || showDaysOfSurroundingMonths ? day.css : \'\'}}\n                {{ is.otherMonth(day.date) ? cssDaysOfSurroundingMonths : \'\'}}"\n         title="{{day.title}}"\n         ng-repeat="day in days track by day.dateValue"\n         ng-click="toggleDay($event, day)"\n         my-xxtouchstart="touchStart($event, day)"\n         ng-mouseover="hoverDay($event, day)"\n         ng-mouseleave="dayHover($event, day)"\n         ng-class="{\n            \'picker-selected\': is.selected(day.date),\n            \'picker-off\': !day.selectable,\n            \'today\': is.today(day.date),\n            \'past\': is.past(day.date),\n            \'future\': is.future(day.date),\n            \'picker-other-month\': is.otherMonth(day.date)\n          }">\n          {{day ? day.mdp.otherMonth && !showDaysOfSurroundingMonths ? \'&nbsp;\' : day.date.format(\'D\') : \'\'}}\n\n          <div ng-if="day.annotation !== null" class="annotation">\n            {{day.annotation}}\n          </div>\n    </div>\n  </div>\n</div>',link:function(e){e.ngModel=e.ngModel||[],e.cache={selectedDates:{},highlightDays:{},today:moment()},e.is={selected:function(t){return t.valueOf()in e.cache.selectedDates},today:function(t){return e.cache.today.isSame(t,"day")},past:function(t){return e.cache.today.isBefore(t,"day")},future:function(t){return e.cache.today.isAfter(t,"day")},otherMonth:function(t){return!e.month.isSame(t,"month")}};var n=function(){var t=moment(),n=moment(e.month).subtract(1,"month"),a=moment(e.month).add(1,"month");e.disableBackButton=e.disallowBackPastMonths&&t.isAfter(n,"month"),e.disableNextButton=e.disallowGoFuturMonths&&t.isBefore(a,"month")},a=function(){for(var t=moment().localeData()._weekdaysMin,n=[],a=1;7>a;a++)n.push(t[a]);return e.sundayFirstDay?n.splice(0,0,t[0]):n.push(t[0]),n};e.$watch("ngModel",function(t){e.cache.selectedDates=t?_.keyBy(t,function(t){return t.valueOf()}):{}},!0),e.$watch("highlightDays",function(n){t.isArray(n)?e.cache.highlightDays=_.keyBy(n,function(t){var e=moment(t.date);return Date.UTC(e.year(),e.month(),e.date())}):e.cache.highlightDays={},e.generate()},!0),e.$watch("weekDaysOff",function(){e.generate()},!0),e.$watch("allDaysOff",function(){e.generate()},!0),e.$watch("daysAllowed",function(){e.generate()},!0),e.month=e.month||moment().startOf("day"),e.days=[],e.weekDaysOff=e.weekDaysOff||[],e.daysOff=e.daysOff||[],e.disableBackButton=!1,e.disableNextButton=!1,e.daysOfWeek=a(),e.cssDaysOfSurroundingMonths=e.cssDaysOfSurroundingMonths||"picker-empty",e.toggleDay=function(t,n){if(t.preventDefault(),!e.is.otherMonth(n.date)||e.fireEventsForDaysOfSurroundingMonths){var a=!1;t.preventDefault=function(){a=!0},"function"==typeof e.dayClick&&e.dayClick(t,n),n.selectable&&!a&&(_.some(e.ngModel,function(t){return t.isSame(n.date,"day")})?e.ngModel=_.filter(e.ngModel,function(t){return!t.isSame(n.date,"day")}):e.ngModel.push(n.date))}},e.touchStart=function(t,e){console.log("touchStart"),t.preventDefault(),this.toggleDay(t,e)},e.hoverDay=function(t,n){t.preventDefault();var a=!1;t.preventDefault=function(){a=!0},"function"==typeof e.dayHover&&e.dayHover(t,n)},e.previousMonth=function(){if(!e.disableBackButton){var t=moment(e.month);e.month=e.month.subtract(1,"month"),"function"==typeof e.monthChanged&&e.monthChanged(e.month,t),e.generate()}},e.nextMonth=function(){if(!e.disableNextButton){var t=moment(e.month);e.month=e.month.add(1,"month"),"function"==typeof e.monthChanged&&e.monthChanged(e.month,t),e.generate()}},e.isDayOff=function(n){var a=Date.UTC(n.date.year(),n.date.month(),n.date.date());return e.allDaysOff||!!e.disableDaysBefore&&moment(n.date).isBefore(e.disableDaysBefore,"day")||!!e.disableDaysAfter&&moment(n.date).isAfter(e.disableDaysAfter,"day")||t.isArray(e.weekDaysOff)&&e.weekDaysOff.some(function(t){return n.date.day()===t})||t.isArray(e.daysOff)&&e.daysOff.some(function(t){return n.date.isSame(t,"day")})||t.isArray(e.daysAllowed)&&!e.daysAllowed.some(function(t){return n.date.isSame(t,"day")})||a in e.cache.highlightDays&&!e.cache.highlightDays[a].selectable},e.isSelected=function(t){return e.ngModel.some(function(e){return t.date.isSame(e,"day")})},e.generate=function(){var a=moment(e.month).date(0).day(e.sundayFirstDay?0:1).subtract(1,"day");moment(e.month).date(0).diff(a,"day")>6&&(a=a.add(1,"week"));var o=moment(e.month).date(1),i=[],s=(moment(),moment(o).endOf("month")),d=function(){var n={date:moment(a.add(1,"day")),dateValue:0,annotation:null};if(n.dateValue=n.date.valueOf(),t.isArray(e.highlightDays)){var o=e.highlightDays.filter(function(t){return n.date.isSame(t.date,"day")});o.length>0?(n.css=o[0].css,n.title=o[0].title,n.annotation=o[0].annotation):(n.css="",n.title="",n.annotation=null)}return n.selectable=!e.isDayOff(n),n},r=s.diff(a,"days"),c=e.sundayFirstDay?6:0;s.day()!==c&&(r+=(e.sundayFirstDay?6:7)-s.day());for(var u=0;r>u;u++)i.push(d());e.days=i,n()},e.generate()}}},a=e("touchstart"),o=e("touchend"),i=e("touchmove");t.module("multipleDatePicker",[]).directive("myTouchstart",a).directive("myTouchend",o).directive("myTouchmove",i).directive("multipleDatePicker",n)})(window.angular);